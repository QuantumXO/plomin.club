!function(e){function r(){}var t={fallback_id:"",fallback_dropzoneClick:!0,url:"",refresh:1e3,paramname:"userfile",requestType:"POST",allowedfileextensions:[],allowedfiletypes:[],maxfiles:25,maxfilesize:1,queuefiles:0,queuewait:200,data:{},headers:{},drop:r,dragStart:r,dragEnter:r,dragOver:r,dragLeave:r,docEnter:r,docOver:r,docLeave:r,beforeEach:r,afterAll:r,rename:r,error:function(e,r,t,n){alert(e)},uploadStarted:r,uploadFinished:r,progressUpdated:r,globalProgressUpdated:r,speedUpdated:r},n=["BrowserNotSupported","TooManyFiles","FileTooLarge","FileTypeNotAllowed","NotFound","NotReadable","AbortError","ReadError","FileExtensionNotAllowed"];e.fn.filedrop=function(r){function a(r,t,n,a){var o="\r\n",i="",l=h.paramname;if(h.data){var s=e.param(h.data).replace(/\+/g,"%20").split(/&/);e.each(s,function(){var e=this.split("=",2),r=decodeURIComponent(e[0]),t=decodeURIComponent(e[1]);2===e.length&&(i+="--",i+=a,i+=o,i+='Content-Disposition: form-data; name="'+r+'"',i+=o,i+=o,i+=t,i+=o)})}return jQuery.isFunction(l)&&(l=l(r)),i+="--",i+=a,i+=o,i+='Content-Disposition: form-data; name="'+(l||"")+'"',i+='; filename="'+encodeURIComponent(r)+'"',i+=o,i+="Content-Type: "+n,i+=o,i+=o,i+=t,i+=o,i+="--",i+=a,i+="--",i+=o}function o(e){if(e.lengthComputable){var r=Math.round(100*e.loaded/e.total);if(this.currentProgress!==r){this.currentProgress=r,h.progressUpdated(this.index,this.file,this.currentProgress),g[this.global_progress_index]=this.currentProgress,i();var t=(new Date).getTime(),n=t-this.currentStart;if(n>=h.refresh){var a=(e.loaded-this.startData)/n;h.speedUpdated(this.index,this.file,a),this.startData=e.loaded,this.currentStart=t}}}}function i(){if(0!==g.length){var e,r=0;for(e in g)g.hasOwnProperty(e)&&(r+=g[e]);h.globalProgressUpdated(Math.round(r/g.length))}}function l(){if(v=!1,!p)return h.error(n[0]),!1;if(h.allowedfiletypes.push&&h.allowedfiletypes.length)for(r=p.length;r--;)if(!p[r].type||e.inArray(p[r].type,h.allowedfiletypes)<0)return h.error(n[3],p[r]),!1;if(h.allowedfileextensions.push&&h.allowedfileextensions.length)for(var r=p.length;r--;){var t=!1;for(T=0;T<h.allowedfileextensions.length;T++)p[r].name.substr(p[r].name.length-h.allowedfileextensions[T].length).toLowerCase()==h.allowedfileextensions[T].toLowerCase()&&(t=!0);if(!t)return h.error(n[8],p[r]),!1}var l=0,c=0;if(m>h.maxfiles&&0===h.queuefiles)return h.error(n[1]),!1;for(var y=[],w=[],b=[],T=0;T<m;T++)y.push(T);var x=function(e){setTimeout(R,e)},R=function(){var e;if(v)return!1;if(h.queuefiles>0&&w.length>=h.queuefiles)return x(h.queuewait);e=y[0],y.splice(0,1),w.push(e);try{if(!1!==d(p[e])){if(e===m)return;var r=new FileReader,t=1048576*h.maxfilesize;if(r.index=e,p[e].size>t)return h.error(n[2],p[e],e),w.forEach(function(r,t){r===e&&w.splice(t,1)}),c++,!0;r.onerror=function(e){switch(e.target.error.code){case e.target.error.NOT_FOUND_ERR:return h.error(n[4]),!1;case e.target.error.NOT_READABLE_ERR:return h.error(n[5]),!1;case e.target.error.ABORT_ERR:return h.error(n[6]),!1;default:return h.error(n[7]),!1}},r.onloadend=h.beforeSend?function(r){h.beforeSend(p[e],e,function(){A(r)})}:A,r.readAsDataURL(p[e])}else c++}catch(r){return w.forEach(function(r,t){r===e&&w.splice(t,1)}),h.error(n[0]),!1}y.length>0&&R()},A=function(r){var t=(r.srcElement||r.target).index;void 0===r.target.index&&(r.target.index=s(r.total));var n,d=new XMLHttpRequest,y=d.upload,T=p[r.target.index],x=r.target.index,R=(new Date).getTime(),A="------multipartformboundary"+(new Date).getTime(),E=g.length,_=u(T.name),C=T.type;h.withCredentials&&(d.withCredentials=h.withCredentials);var D=r.target.result.split(",")[1],q=void 0===D?"":atob(D);n="string"==typeof _?a(_,q,C,A):a(T.name,q,C,A),y.index=x,y.file=T,y.downloadStartTime=R,y.currentStart=R,y.currentProgress=0,y.global_progress_index=E,y.startData=0,y.addEventListener("progress",o,!1),jQuery.isFunction(h.url)?d.open(h.requestType,h.url(y),!0):d.open(h.requestType,h.url,!0),d.setRequestHeader("content-type","multipart/form-data; boundary="+A),d.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.each(h.headers,function(e,r){d.setRequestHeader(e,r)}),d.sendAsBinary||(d.sendAsBinary=function(e){var r=Array.prototype.map.call(e,function(e){return 255&e.charCodeAt(0)}),t=new Uint8Array(r);this.send(t.buffer)}),d.sendAsBinary(n),g[E]=0,i(),h.uploadStarted(x,T,m),d.onload=function(){var e=null;if(d.responseText)try{e=jQuery.parseJSON(d.responseText)}catch(r){e=d.responseText}var r=(new Date).getTime()-R,n=h.uploadFinished(x,T,e,r,d);l++,w.forEach(function(e,r){e===t&&w.splice(r,1)}),b.push(t),g[E]=100,i(),l===m-c&&f(),!1===n&&(v=!0),(d.status<200||d.status>299)&&h.error(d.statusText,T,t,d.status)}};R()}function s(e){for(var r=0;r<m;r++)if(p[r].size===e)return r}function u(e){return h.rename(e)}function d(e){return h.beforeEach(e)}function f(){return h.afterAll()}var c,p,h=e.extend({},t,r),g=[],v=!1,m=0;if(!0===h.fallback_dropzoneClick&&e("#"+h.fallback_id).css({display:"none",width:0,height:0}),this.on("drop",function(e){if(!1===h.drop.call(this,e))return!1;if(e.originalEvent.dataTransfer)return null===(p=e.originalEvent.dataTransfer.files)||void 0===p||0===p.length?(h.error(n[0]),!1):(m=p.length,l(),e.preventDefault(),!1)}).on("dragstart",h.dragStart).on("dragenter",function(e){clearTimeout(c),e.preventDefault(),h.dragEnter.call(this,e)}).on("dragover",function(e){clearTimeout(c),e.preventDefault(),h.docOver.call(this,e),h.dragOver.call(this,e)}).on("dragleave",function(e){clearTimeout(c),h.dragLeave.call(this,e),e.stopPropagation()}),e(document).on("drop",function(e){return e.preventDefault(),h.docLeave.call(this,e),!1}).on("dragenter",function(e){return clearTimeout(c),e.preventDefault(),h.docEnter.call(this,e),!1}).on("dragover",function(e){return clearTimeout(c),e.preventDefault(),h.docOver.call(this,e),!1}).on("dragleave",function(e){c=setTimeout(function(r){return function(){h.docLeave.call(r,e)}}(this),200)}),!0===h.fallback_dropzoneClick){if(this.find("#"+h.fallback_id).length>0)throw"Fallback element ["+h.fallback_id+"] cannot be inside dropzone, unless option fallback_dropzoneClick is false";this.on("click",function(r){e("#"+h.fallback_id).trigger(r)})}return e("#"+h.fallback_id).change(function(e){h.drop(e),p=e.target.files,m=p.length,l()}),this};try{if(XMLHttpRequest.prototype.sendAsBinary)return;XMLHttpRequest.prototype.sendAsBinary=function(e){var r=Array.prototype.map.call(e,function(e){return 255&e.charCodeAt(0)}),t=new Uint8Array(r);"ArrayBufferView"in window?this.send(t):this.send(t.buffer)}}catch(e){}}(jQuery);